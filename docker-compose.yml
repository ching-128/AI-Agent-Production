version: "3.8"

services:
    ai-agent-server:
        build:
            context: .
            dockerfile: Dockerfile
        container_name: ai-agent-server
        ports:
            - "3000:3000"
        environment:
            - NODE_ENV=production
            - PORT=3000
            - OPENAI_API_KEY=${OPENAI_API_KEY}
            - WEATHER_API_KEY=${WEATHER_API_KEY}
        volumes:
            - ./log:/app/log
        restart: unless-stopped
        healthcheck:
            test:
                [
                    "CMD",
                    "node",
                    "-e",
                    "require('http').get('http://localhost:3000', (r) => {if
                    (r.statusCode !== 200) throw new Error(r.statusCode)})",
                ]
            interval: 30s
            timeout: 10s
            retries: 3
            start_period: 5s
